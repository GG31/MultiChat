<!DOCTYPE html>
<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name='keywords' content='WebRTC, HTML5, JavaScript' />
<meta name='description' content='WebRTC Reference App' />
<meta name='viewport' content='width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1'>

<link rel="stylesheet" type="text/css" href="css/main.css">

<base target='_blank'>

<title>WebRTC client</title>

<!-- <link rel='stylesheet' href='css/main.css' /> -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
<script src="js/app.js"></script>

</head>
<body onload="initialize()" ng-app="multichat" ng-controller="IndexCtrl" >

<div id='container'>
   <div id="col-left">   
      <!-- liste de tous les utilisateurs connectes -->  
      <h2>{{profils.pseudo}}</h2> <!-- TEST -->
      <div id="profils" ng-repeat="profil in profils">
         <div id="pseudo">
            <h4>{{profil.pseudo}}</h4>
            <video id='remoteVideo' autoplay>{{profil.video}}</video>
         </div>
      </div>
      <!-- historique des anciens chat -->
      <div id="historical-container">
         <h3>Historique</h3>
         <div id="historical-container-area">
            
         </div>
      </div>
   </div>
   <div id="col-center">
      <div id="header">
         <h1> Welcome in the room {{roomName}}</h1>
      </div>
      <div id='active-video'>
         <h4 id='video-left'>{{pseudoActif}}</h4>
         <video id='activeVideo' autoplay></video>
         <div id='video-right'></div>
      </div>
      <div id="col-center-bottom">
         <div id="map-container">
         <!--
            <p id="msg">Click the button to get your coordinates:</p>
            <p id="address"></p>
          
            <button onclick="getLocation()">Where am I ?</button>
        -->
            <div id="map_canvas"></div>
            
         </div>   
         <div id="local-video">
            <video id='localVideo' autoplay muted></video>
         </div>      
      </div>
   </div>
   <div id="col-right">
      <div id="common-repository">
         <h3>Répertoire</h3>
         <div id="common-repository-area">
            <ul ng-repeat="file in files">
               <li>{{file.title}}</li>
            </ul>
         </div>
      </div>
      <div id="chat-container">
         <h3>Chat</h3>
         <div id='textareas'>
		      <!-- <textarea id="dataChannelReceive" disabled></textarea> 
		         // ne peut pas mettre de style dans un textarea...
		      -->
		      <!-- <div id="dataChannelReceive" disabled></div> Attention, ne reçoit plus de message-->
		      <div id="dataChannelReceive" disabled>
		         <table id='chat-table'>
		            <!--<tr>
		               <td class="color4">
		                  Bob&nbsp:
		               </td>
		               <td>Bonjour tout le monde, vous allez bien?</td>
		            </tr>-->
		         </table>
		      </div>
		      <input type="text" id="dataChannelSend" disabled placeholder="Enter some text, then press Send.">
            <input type="submit" id="sendButton" value="Send" disabled>
	      </div>          
      </div>      
   </div>
</div>

      <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    
    <script>
      // Default position
    var centerpos = new google.maps.LatLng(48.579400,7.7519);

    // default options for the google map
    var optionsGmaps = {
        center:centerpos,
        navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        zoom: 15
    };

    // Init map
    var map = new google.maps.Map(document.getElementById("map_canvas"), optionsGmaps);

    if(navigator.geolocation) {

        // callback function, called by getCurrentPosition() in case of success
        function drawPosition(position) {

            var infopos = "Position: ";
            infopos += "Lat : "+position.coords.latitude + ", ";
            infopos += "Long: "+position.coords.longitude+", ";
            infopos += "Alt : "+position.coords.altitude +"<br>";
            //document.getElementById("address").innerHTML = infopos;

            // Make new object LatLng for Google Maps
            var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

            // Add a marker at position
            var marker = new google.maps.Marker({
                position: latlng,
                map: map,
                title:"You are here"
            });

            map.panTo(latlng);

        }

        // callback function, called by getCurrentPosition() in case of error
        function errorPosition(error) {
            var info = "Error during geolocation : ";
            switch(error.code) {
                case error.TIMEOUT:
                    info += "Timeout !";
                    break;
                case error.PERMISSION_DENIED:
                    info += "You did not give access to the geolocation API";
                    break;
                case error.POSITION_UNAVAILABLE:
                    info += "Position could not be determined";
                    break;
                case error.UNKNOWN_ERROR:
                    info += "Unknown error";
                    break;
            }
            //document.getElementById("address").innerHTML = info;
        }

        navigator.geolocation.getCurrentPosition(drawPosition,errorPosition);

    } else {

        alert("Geolocation API not supported by your browser");

    }
    </script>
    
<script src='/socket.io/socket.io.js'></script>
<script src='js/lib/adapter.js'></script>

<script src='js/scripts_init.js'></script>
<script src='js/socketOn.js'></script>
<script src='js/mediaHandlers.js'></script>
<script src='js/main.js'></script>
<script src='js/size.js'></script>



</body>
</html>
