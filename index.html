<!DOCTYPE html>
<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name='keywords' content='WebRTC, HTML5, JavaScript' />
<meta name='description' content='WebRTC Reference App' />
<meta name='viewport' content='width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1'>

<link rel="stylesheet" type="text/css" href="css/main.css">

<base target='_blank'>

<title>WebRTC client</title>

<!-- <link rel='stylesheet' href='css/main.css' /> -->
<script src='js/lib/jquery-1.11.2.min.js'></script>

<script src='/socket.io/socket.io.js'></script>
<script src='js/lib/adapter.js'></script>

<script src='js/misc.js'></script>
<script src='js/socketOn.js'></script>
<script src='js/scripts_init.js'></script>
<script src='js/mediaHandlers.js'></script>

</head>
<body ondragenter="dragEnterHandler(event)">

<div class='container'>
   <div id="col-left">   
      <!-- liste de tous les utilisateurs connectes -->
      <div id="profils-container">
      
            <div id="profil">
               <h4 class="color4">Pseudo BLABLA</h4>
               <video class='remoteVideo' autoplay></video>
            </div>
       
      </div>
      <!-- historique -->
      <div id="historical-container">
         <h3>Historique</h3>
         <div id="historical-container-area">
            <!--
               <div class="date">dd/mm/yy hh:mm</div>
               <div class="transfer">User send the file "file.txt"</div>
		         <div class="date">dd/mm/yy hh:mm</div>
		         <div class="connect">User has connected to this room</div>
		         <div class="date">dd/mm/yy hh:mm</div>
		         <div class="disconnect">User has disconnected to this room</div>
            -->
         </div>
      </div>
   </div>
   <div id="col-center">
      <div id="header">
         <h1> Bienvenue dans la salle <span id="roomRoom"></span></h1>
         <script>setInfoToDom("#roomRoom",getRoom());</script>
             <!---->
             <div id="UploadBox">
              <h2>Video Uploader</h2>
              <span id='UploadArea'>
                  <label for="FileBox">Choose A File: </label><input type="file" id="FileBox"><br>
                  <label for="NameBox">Name: </label><input type="text" id="NameBox"><br>
       
                  <button  type='button' id='UploadButton' class='Button'>Upload</button>
                  <a id="downloadFile" href="" target="_blank">Download</a>
              </span>
          </div>
      </div>
      <div id='active-video'>
         <h4 id='video-left'><!--pseudoActif--></h4>
         <video id='activeVideo' autoplay></video>
         <div id='video-right'></div>
      </div>
      <div id="col-center-bottom">
         <div id="map-container">
            <div id="map_canvas"></div>            
         </div>   
         <div id="local-video">
            <video id='localVideo' autoplay></video>
         </div>      
      </div>
   </div>
   <div id="col-right">
      <div id="common-repository">
         <h3>Répertoire</h3>
         <div id="common-repository-area">       
            <ul id="common-repository-ul">
            <!--      
               <li><a href="#">file.txt</a></li>
               <li><a href="#">file.txt</a></li>
            -->
            </ul>
         </div>
         <div id="droppableZone" ondrop="dropHandler(event)" ondragover="return false;">
            <div class="titlebox">Drop zone :</div>
            <div id="droppableZone-container">
               <ul id="droppedFiles"></ul>
            </div>
         </div>
      </div>
      <div id="chat-container">
         <h3>Chat</h3>
         <div id='textareas'>
		      <!-- <textarea id="dataChannelReceive" disabled></textarea> 
		         // ne peut pas mettre de style dans un textarea...
		      -->
		      <!-- <div id="dataChannelReceive" disabled></div> Attention, ne reçoit plus de message-->
		      <div id="dataChannelReceive" disabled>
		            <!--
		               <div class="color4"> <!-- Pseudo sur une ligne et en dessous le commentaire
		                  Bob&nbsp;:
		               </div>
		               <div class="color4-paragraph">Bonjour tout le monde, vous allez bien?</div>
		            -->
		         </table>
		      </div>
		      <input type="text" id="dataChannelSend" disabled placeholder="Enter some text, then press Send.">
		       <button id="submitButton" onclick="sendNewChat();">Send</button> 
	      </div>          
      </div>      
   </div>
</div>

      <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    
    <script>
      // Default position
    var centerpos = new google.maps.LatLng(48.579400,7.7519);

    // default options for the google map
    var optionsGmaps = {
        center:centerpos,
        navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        zoom: 15
    };

    // Init map
    var map = new google.maps.Map(document.getElementById("map_canvas"), optionsGmaps);

    if(navigator.geolocation) {

        // callback function, called by getCurrentPosition() in case of success
        function drawPosition(position) {

            var infopos = "Position: ";
            infopos += "Lat : "+position.coords.latitude + ", ";
            infopos += "Long: "+position.coords.longitude+", ";
            infopos += "Alt : "+position.coords.altitude +"<br>";
            //document.getElementById("address").innerHTML = infopos;

            // Make new object LatLng for Google Maps
            var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

            // Add a marker at position
            var marker = new google.maps.Marker({
                position: latlng,
                map: map,
                title:"You are here"
            });

            map.panTo(latlng);

        }

        // callback function, called by getCurrentPosition() in case of error
        function errorPosition(error) {
            var info = "Error during geolocation : ";
            switch(error.code) {
                case error.TIMEOUT:
                    info += "Timeout !";
                    break;
                case error.PERMISSION_DENIED:
                    info += "You did not give access to the geolocation API";
                    break;
                case error.POSITION_UNAVAILABLE:
                    info += "Position could not be determined";
                    break;
                case error.UNKNOWN_ERROR:
                    info += "Unknown error";
                    break;
            }
            //document.getElementById("address").innerHTML = info;
        }

        navigator.geolocation.getCurrentPosition(drawPosition,errorPosition);

    } else {

        alert("Geolocation API not supported by your browser");

    }
    </script>

    <script src='js/main.js'></script>
    <script src='js/size.js'></script>
    <script src='js/globalManagement.js'></script>

<script>
      $(document).ready( function(){
        $(document).keypress(function( event ) {
            if ( event.which == 13 ) {
                sendNewChat();
            }
        });
      });
      
      
      function dragEnterHandler(event) {
        console.log("Drag enter");
        // Show some visual feedback
        document.getElementById("droppableZone").classList.add('draggedOver'); 
      }
      function dropHandler(event) {
          console.log('drop event');
          document.getElementById("droppableZone").classList.remove('draggedOver'); 
        
         // Do not propagate the event
         event.stopPropagation();
         // Prevent default behavior, in particular when we drop images or links
          event.preventDefault(); 
        
      
        // reset the visual look of the drop zone to default
        event.target.classList.remove('draggedOver'); 
        
       
        // get the files from the clipboard
        var files = event.dataTransfer.files;
        var filesLen = files.length; 
        var filenames = "";
        if(filesLen > 0){
         SelectedFile = files[filesLen-1];
           //FileChosen(event, filesLen-1);
           StartUpload();
        }
 
        // iterate on the files, get details using the file API
        // Display file names in a list.
       for(var i = 0 ; i < filesLen ; i++) {
           filenames += '\n' + files[i].name; 
           // Create a li, set its value to a file name, add it to the ol
           var li = document.createElement('li');
           li.textContent = files[i].name;    
           document.querySelector("#droppedFiles").appendChild(li);
       }
     console.log(files.length + ' file(s) have been dropped:\n' + filenames);
        
    }  
</script>

</body>
</html>
